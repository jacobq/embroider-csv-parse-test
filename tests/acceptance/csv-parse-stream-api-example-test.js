import { module, test } from 'qunit';
import { click, visit, currentURL } from '@ember/test-helpers';
import { setupApplicationTest } from 'ember-qunit';

module('Acceptance | csv-parse stream API example', function (hooks) {
  setupApplicationTest(hooks);

  test('it generates output when test button is clicked and clears it when clear button is clicked', async function (assert) {
    await visit('/');
    assert.strictEqual(currentURL(), '/');
    const ulSelector = 'ul[data-test-id="output"]';
    const liSelector = `${ulSelector} > li`;
    assert.dom(ulSelector).hasText('No records received');
    await click('[data-test-id="run-example-button"]');
    assert.dom(ulSelector).hasText(/record\s+\d+:/i);
    assert.dom(ulSelector).includesText('root,x,0,0,root,/root,/bin/bash');
    const liElements = document.querySelectorAll(liSelector);
    assert.strictEqual(
      liElements.length,
      2,
      'There should be 2 records generated by the example'
    );

    await click('[data-test-id="clear-button"]');
    assert.dom(ulSelector).hasText('No records received');
    assert.strictEqual(
      document.querySelectorAll(liSelector).length,
      0,
      'Should have reset/cleared array'
    );
  });
});
